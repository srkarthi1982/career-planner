---
const rootAppUrl = Astro.locals.rootAppUrl ?? "https://ansiversa.com";
const fallbackUrl = new URL("/", Astro.url).toString();
const returnToParam = Astro.url.searchParams.get("returnTo");

let safeReturnTo = fallbackUrl;
if (returnToParam) {
  try {
    const fallback = new URL(fallbackUrl);
    const resolved = new URL(returnToParam, fallback);
    if (resolved.origin === fallback.origin) {
      safeReturnTo = resolved.toString();
    }
  } catch {
    safeReturnTo = fallbackUrl;
  }
}

const target = new URL("/forgot-password", rootAppUrl);
target.searchParams.set("returnTo", safeReturnTo);
return Astro.redirect(target.toString());
---
